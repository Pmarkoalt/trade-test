# Production Run Configuration
# Production-ready configuration for live backtesting and validation
# Based on EXAMPLE_CONFIGS/run_config.yaml with production settings

# Dataset configuration
dataset:
  equity_path: "data/equity/ohlcv/"  # Path to equity OHLCV files
  crypto_path: "data/crypto/ohlcv/"  # Path to crypto OHLCV files
  benchmark_path: "data/benchmarks/"  # Path to SPY and BTC data

  # File format: CSV with columns: date, symbol, open, high, low, close, volume
  # Or specify format: "parquet", "csv", "database"
  format: "csv"

  # Date range for entire dataset (production: extended range)
  # Update these dates based on your production data availability
  start_date: "2022-01-01"  # Extended lookback for production
  end_date: "2024-12-31"  # Current date or latest available

  # Minimum lookback required (for indicators)
  min_lookback_days: 250

# Data splits (pre-registered, LOCKED)
# IMPORTANT: These dates must be LOCKED before any backtesting begins
# Production splits should use recent data with proper train/validation/holdout periods
splits:
  # 24-month dataset (preferred for production)
  train_start: "2022-01-01"
  train_end: "2023-09-30"  # Months 1-21 (21 months)

  validation_start: "2023-10-01"
  validation_end: "2024-03-31"  # Months 22-27 (6 months)

  holdout_start: "2024-04-01"
  holdout_end: "2024-12-31"  # Months 28-36 (9 months) - LOCKED

  # Alternative: 18-month minimum
  # train_start: "2023-01-01"
  # train_end: "2023-12-31"  # Months 1-12
  # validation_start: "2024-01-01"
  # validation_end: "2024-03-31"  # Months 13-15
  # holdout_start: "2024-04-01"
  # holdout_end: "2024-06-30"  # Months 16-18

# Strategy configurations to load
# Production configs should reference production strategy configs
strategies:
  equity:
    config_path: "configs/production_equity_config.yaml"
    enabled: true

  crypto:
    config_path: "configs/production_crypto_config.yaml"
    enabled: true

# Portfolio configuration
portfolio:
  starting_equity: 100000  # USD - adjust for production capital
  # Risk parameters are in strategy configs (frozen)

# Volatility scaling (portfolio-level)
volatility_scaling:
  enabled: true
  mode: "continuous"  # "continuous", "regime", or "off"
  lookback: 20  # Days for rolling volatility
  baseline_lookback: 252  # Days for median baseline
  min_multiplier: 0.33  # Minimum risk multiplier
  max_multiplier: 1.0  # Maximum risk multiplier

# Correlation guard
correlation_guard:
  enabled: true
  min_positions: 4  # Apply only if >= 4 positions
  avg_pairwise_threshold: 0.70  # Reject if avg correlation > 0.70
  candidate_threshold: 0.75  # Reject candidate if corr > 0.75 to portfolio

# Scoring function (position queue)
scoring:
  weights:
    breakout: 0.50  # Breakout strength weight
    momentum: 0.30  # Relative momentum weight
    diversification: 0.20  # Diversification bonus weight

# Execution configuration
execution:
  signal_timing: "close"  # Signals generated at day close
  execution_timing: "next_open"  # Orders filled at next day open
  slippage_model: "full"  # "full", "simple", or "none" (use "full" for production)

# Output configuration
output:
  base_path: "results/production/"  # Production results directory
  run_id: null  # Auto-generated if null: "run_YYYYMMDD_HHMMSS"

  # Output files
  equity_curve: "equity_curve.csv"
  trade_log: "trade_log.csv"
  weekly_summary: "weekly_summary.csv"
  monthly_report: "monthly_report.json"
  scenario_comparison: "scenario_comparison.json"

  # Logging (production: INFO level recommended)
  log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_file: "backtest.log"
  log_json_format: false  # Set to true for structured logging
  log_use_rich: true  # Rich console output

# Reproducibility
random_seed: 42  # Seed for RNG (slippage, bootstrap, permutation tests)

# Research & News
research:
  enabled: true
  lookback_hours: 48
  max_articles_per_symbol: 10
  # API keys should be set via environment variables:
  # NEWSAPI_API_KEY, ALPHA_VANTAGE_API_KEY
  # Or set directly here (not recommended for production)
  newsapi_key: null  # Set via NEWSAPI_API_KEY env var
  alpha_vantage_key: null  # Set via ALPHA_VANTAGE_API_KEY env var

  sentiment:
    use_vader: true
    use_finbert: false  # Phase 4 - requires GPU
    vader_threshold_positive: 0.05
    vader_threshold_negative: -0.05
    min_confidence: 0.5

  relevance:
    min_relevance_score: 0.3
    title_weight: 0.6
    summary_weight: 0.4

# Signal Generation
signals:
  max_recommendations: 5
  min_conviction: "MEDIUM"
  technical_weight: 0.6
  news_weight: 0.4
  news_enabled: true
  news_lookback_hours: 48
  min_news_score_for_boost: 7.0
  max_news_score_for_penalty: 3.0

# Validation configuration (for validate command)
validation:
  # Parameter sensitivity grid
  sensitivity:
    enabled: true
    equity_atr_mult: [2.0, 2.5, 3.0, 3.5]
    equity_breakout_clearance: [0.000, 0.005, 0.010, 0.015]
    equity_exit_ma: [20, 50]
    crypto_atr_mult: [2.5, 3.0, 3.5, 4.0]
    crypto_breakout_clearance: [0.000, 0.005, 0.010, 0.015]
    crypto_exit_mode: ["MA20", "MA50", "staged"]
    vol_scaling_mode: ["continuous", "regime", "off"]

  # Stress tests
  stress_tests:
    slippage_multipliers: [1.0, 2.0, 3.0]  # Baseline, 2x, 3x
    bear_market_test: true
    range_market_test: true
    flash_crash_test: true

  # Statistical tests
  statistical:
    bootstrap_iterations: 1000
    permutation_iterations: 1000
    bootstrap_5th_percentile_threshold: 0.4  # Reject if < 0.4

# Metrics targets (for holdout evaluation)
# Production: Stricter thresholds recommended
metrics:
  primary:
    sharpe_ratio_min: 1.0
    max_drawdown_max: 0.15  # 15%
    calmar_ratio_min: 1.5
    min_trades: 50  # Combined equities + crypto

  secondary:
    expectancy_R_min: 0.3
    profit_factor_min: 1.4
    correlation_to_benchmark_max: 0.80
    percentile_99_daily_loss_max: 0.05  # 5%

  rejection:
    max_drawdown_max: 0.20  # >20% = reject
    sharpe_ratio_min: 0.75  # <0.75 = reject
    calmar_ratio_min: 1.0  # <1.0 = reject

